<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>HDPE Tycoon Ultimate - Market & UI Fix</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
    /* Button b√°n h√†ng - Hi·ªáu ·ª©ng ti·ªÅn */
.sell-btn {
    position: relative;
    overflow: visible;
}

.sell-btn:hover {
    animation: coinShine 1.5s infinite;
}

@keyframes coinShine {
    0%, 100% { box-shadow: 0 0 10px var(--gold); }
    50% { box-shadow: 0 0 25px var(--gold), 0 0 40px rgba(255, 204, 0, 0.5); }
}

.sell-btn:active {
    animation: cashRegister 0.4s ease-out;
}

@keyframes cashRegister {
    0% { transform: scale(1) rotate(0deg); }
    25% { transform: scale(0.95) rotate(-2deg); }
    50% { transform: scale(1.05) rotate(2deg); }
    75% { transform: scale(0.98) rotate(-1deg); }
    100% { transform: scale(1) rotate(0deg); }
}

/* ƒê·ªìng xu bay l√™n */
.coin-particle {
    position: absolute;
    font-size: 24px;
    color: var(--gold);
    pointer-events: none;
    animation: coinFly 1s ease-out forwards;
    text-shadow: 0 0 10px var(--gold);
}

@keyframes coinFly {
    0% { 
        transform: translateY(0) rotate(0deg) scale(0.5); 
        opacity: 1; 
    }
    50% { 
        transform: translateY(-50px) rotate(180deg) scale(1); 
        opacity: 1; 
    }
    100% { 
        transform: translateY(-100px) rotate(360deg) scale(0.3); 
        opacity: 0; 
    }
}
    /* Button n√©n kh√≠ - Hi·ªáu ·ª©ng compress */
.compress-btn {
    position: relative;
    overflow: hidden;
}

.compress-btn::before {
    content: "";
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 242, 255, 0.4), transparent);
    transition: left 0.5s;
}

.compress-btn:hover::before {
    left: 100%;
}

.compress-btn:active {
    animation: compressEffect 0.3s ease-out;
}

@keyframes compressEffect {
    0% { transform: scale(1); }
    50% { transform: scale(0.9) scaleY(1.1); } /* N√©n ngang, d√£n d·ªçc */
    100% { transform: scale(1); }
}

/* Particles n√©n */
.compress-particle {
    position: absolute;
    width: 8px; height: 8px;
    background: var(--primary);
    border-radius: 50%;
    pointer-events: none;
    animation: compressParticle 0.8s ease-out forwards;
}

@keyframes compressParticle {
    0% { 
        transform: translate(var(--x), var(--y)) scale(1); 
        opacity: 1; 
    }
    100% { 
        transform: translate(0, 0) scale(0); 
        opacity: 0; 
    }
}
    /* Th√™m v√†o ph·∫ßn <style> */

/* Animation cho n√∫t ch√≠nh - M√°y n√©n th·ª±c t·∫ø */
#main-btn {
    position: relative;
    overflow: visible !important; /* Cho ph√©p hi·ªáu ·ª©ng tr√†n ra ngo√†i */
}

/* V√≤ng s√≥ng √°p su·∫•t khi click */
#main-btn::before {
    content: "";
    position: absolute;
    top: 50%; left: 50%;
    width: 100%; height: 100%;
    border: 3px solid var(--primary);
    border-radius: 20px;
    transform: translate(-50%, -50%) scale(0.8);
    opacity: 0;
    pointer-events: none;
}

#main-btn:active::before {
    animation: pressureWave 0.6s ease-out;
}

@keyframes pressureWave {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

/* Hi·ªáu ·ª©ng kh√≥i kh√≠ phun - N√¢ng cao */
.gas-puff {
    position: absolute;
    background: radial-gradient(circle, rgba(0, 242, 255, 0.6), transparent 70%);
    border-radius: 50%;
    pointer-events: none;
    filter: blur(8px);
    z-index: 1000;
    animation: puffOutRealistic 1.2s ease-out forwards;
}

@keyframes puffOutRealistic {
    0% { 
        transform: scale(0.3) translateY(0); 
        opacity: 0.9; 
    }
    50% { 
        transform: scale(1.5) translateY(-30px); 
        opacity: 0.6; 
    }
    100% { 
        transform: scale(2.5) translateY(-80px) translateX(var(--drift)); 
        opacity: 0; 
    }
}

/* Hi·ªáu ·ª©ng rung l·∫Øc m√°y n√©n */
#main-btn:active {
    animation: machinePress 0.15s cubic-bezier(0.36, 0.07, 0.19, 0.97);
}

@keyframes machinePress {
    0%, 100% { transform: scale(1) translateY(0); }
    25% { transform: scale(0.95) translateY(5px); }
    50% { transform: scale(0.93) translateY(8px); }
    75% { transform: scale(0.96) translateY(3px); }
}

/* ƒê√®n c·∫£nh b√°o nh·∫•p nh√°y khi qu√° nhi·ªát */
#main-btn.overheating::after {
    animation: warningBlink 0.3s infinite;
}

@keyframes warningBlink {
    0%, 100% { background: repeating-linear-gradient(90deg, #ffcc00, #ffcc00 10px, #000 10px, #000 20px); }
    50% { background: repeating-linear-gradient(90deg, #ff0055, #ff0055 10px, #000 10px, #000 20px); }
}
        :root {
            --bg-dark: #0b0c15;
            --panel-bg: rgba(20, 25, 40, 0.95);
            --primary: #00f2ff; /* Cyan Neon */
            --secondary: #7000ff; /* Purple Neon */
            --danger: #ff0055; /* Red Neon */
            --gold: #ffcc00; /* Gold */
            --text-main: #e0e6ed;
            --border-glow: 0 0 10px rgba(0, 242, 255, 0.3);
            --talent-tree: #00ff9d;
            --chart-up: #00ff00;
            --chart-down: #ff3333;
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(112, 0, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 242, 255, 0.1) 0%, transparent 20%),
                url('https://www.transparenttextures.com/patterns/cubes.png');
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- LAYOUT CH√çNH --- */
        .main-interface {
            display: grid;
            grid-template-columns: 320px 1fr 340px;
            gap: 20px;
            width: 98vw;
            height: 95vh;
            max-width: 1800px;
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            overflow: hidden;
            position: relative;
        }

        .panel::before {
            content: ''; position: absolute; top:0; left:0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        h2, h3 { margin: 0 0 15px 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px rgba(255,255,255,0.3); }
        
        /* --- C·ªòT TR√ÅI: TH·ªêNG K√ä --- */
        .stat-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; margin-bottom: 8px;
            border-left: 3px solid var(--primary);
        }
        .stat-val { font-size: 1.3em; font-weight: bold; color: #fff; }
        .currency { color: var(--gold); text-shadow: 0 0 5px var(--gold); }

        /* MARKET CHART CSS */
        .market-panel {
            border: 1px solid #444;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            height: 300px; /* Cao h∆°n m·ªôt ch√∫t cho ƒë·∫πp */
            display: flex;
            flex-direction: column;
        }
        .chart-container {
            flex: 1;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 4px; /* Kho·∫£ng c√°ch gi·ªØa c√°c n·∫øn */
            position: relative;
            border-bottom: 1px solid #555;
            padding-bottom: 5px;
            overflow: hidden;
        }
        .candle {
            width: 100%;
            position: relative;
            transition: all 0.5s;
        }
        .candle-body {
            width: 100%;
            position: absolute;
            left: 0;
            min-height: 2px;
        }
        .candle-wick {
            width: 1px;
            background: #888;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* --- C·ªòT GI·ªÆA: S·∫¢N XU·∫§T --- */
        .center-stage {
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle, rgba(20,20,40,0.8), rgba(0,0,0,0.9));
        }

       /* --- T√åM V√Ä THAY TH·∫æ ƒêO·∫†N #main-btn C≈® B·∫∞NG ƒêO·∫†N N√ÄY --- */
#main-btn {
    width: 220px;
    height: 220px;
    border-radius: 20px; /* H√¨nh kh·ªëi m√°y n√©n */
    border: 6px solid #444;
    background: linear-gradient(145deg, #2c3e50, #000);
    box-shadow: 
        inset 5px 5px 15px rgba(0,0,0,0.8),
        0 0 20px rgba(0, 242, 255, 0.2),
        10px 10px 20px rgba(0,0,0,0.6);
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
    z-index: 10;
}

#main-btn::before {
    content: "";
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: repeating-linear-gradient(45deg, rgba(255,255,255,0.05) 0px, rgba(255,255,255,0.05) 2px, transparent 2px, transparent 10px);
    pointer-events: none;
}

#main-btn::after {
    content: "";
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 15px;
    background: repeating-linear-gradient(90deg, #ffcc00, #ffcc00 10px, #000 10px, #000 20px);
}

#main-btn:active {
    transform: scale(0.92) translateY(8px);
    box-shadow: 0 0 40px rgba(0, 242, 255, 0.6);
    border-color: var(--primary);
}

#main-btn:hover {
    animation: machineVibrate 0.2s infinite ease-in-out;
}

@keyframes machineVibrate {
    0% { transform: translate(1px, 1px) rotate(0deg); }
    50% { transform: translate(-1px, -1px) rotate(0.2deg); }
    100% { transform: translate(1px, -1px) rotate(0deg); }
}

/* D√°n th√™m c√°i n√†y v√†o ngay d∆∞·ªõi ƒëo·∫°n tr√™n */
.gas-puff {
    position: absolute;
    background: rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    pointer-events: none;
    animation: puffOut 0.8s ease-out forwards;
    z-index: 1000;
}

@keyframes puffOut {
    0% { transform: scale(0.5); opacity: 0.8; }
    100% { transform: scale(3) translateY(-50px); opacity: 0; }
}
        #main-btn:active { transform: scale(0.95); box-shadow: 0 0 10px rgba(0, 242, 255, 0.5); }
        #main-btn:hover { border-color: var(--primary); color: #fff; }
        #main-btn i { font-size: 2.5em; margin-bottom: 10px; animation: pulseIcon 2s infinite; }
        @keyframes pulseIcon { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 0.8; } }

        /* Nhi·ªát ƒë·ªô */
        .temp-gauge {
            width: 80%; height: 20px; background: #222; border-radius: 10px; margin-top: 30px;
            position: relative; overflow: hidden; border: 1px solid #444;
        }
        .temp-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--gold), var(--danger));
            transition: width 0.2s;
        }
        .temp-text { text-align: center; margin-top: 5px; font-size: 0.9em; color: #aaa; }

        /* --- C·ªòT PH·∫¢I: TABS --- */
        .tab-header { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap;}
        .tab-btn {
            flex: 1; padding: 8px; background: rgba(255,255,255,0.05); border: none; color: #aaa;
            cursor: pointer; font-family: inherit; font-weight: bold; border-radius: 5px;
            transition: 0.3s; font-size: 0.85em; min-width: 60px;
        }
        .tab-btn.active { background: var(--secondary); color: #fff; box-shadow: 0 0 15px var(--secondary); }

        .tab-content { display: none; overflow-y: auto; flex-grow: 1; padding-right: 5px; }
        .tab-content.active { display: flex; flex-direction: column; gap: 10px; }
        
        .tab-content::-webkit-scrollbar { width: 5px; }
        .tab-content::-webkit-scrollbar-thumb { background: #444; border-radius: 5px; }

        /* Item N√¢ng C·∫•p */
        .upgrade-item {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid transparent; transition: 0.2s; cursor: pointer; user-select: none;
        }
        .upgrade-item:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        .u-info h4 { margin: 0; color: var(--primary); }
        .u-info small { color: #888; display: block; margin-top: 3px; }
        .u-btn { text-align: right; }
        .cost { color: var(--gold); font-weight: bold; display: block; }
        .lvl-badge { background: #333; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-top: 5px; display: inline-block;}

        /* --- TALENT SYSTEM CSS --- */
        .tp-header {
            background: linear-gradient(45deg, #004d33, #000);
            padding: 15px; border-radius: 8px; border: 1px solid var(--talent-tree);
            text-align: center; margin-bottom: 15px;
        }
        .talent-tree { display: flex; flex-direction: column; gap: 15px; position: relative; }
        
        .talent-node {
            background: #1a1a2e; border: 1px solid #444; padding: 12px; border-radius: 8px;
            display: flex; gap: 10px; align-items: center; cursor: pointer;
            transition: 0.2s; position: relative; z-index: 1;
        }
        .talent-node:hover { border-color: var(--talent-tree); background: #222; }
        .talent-node.locked { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }
        .talent-node.maxed { border-color: var(--gold); background: rgba(255, 204, 0, 0.1); }
        
        .t-icon { 
            width: 40px; height: 40px; background: #333; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; color: var(--talent-tree); font-size: 1.2em;
        }
        .t-data { flex: 1; }
        .t-name { font-weight: bold; color: #fff; }
        .t-desc { font-size: 0.8em; color: #aaa; margin-bottom: 5px; display:block;}
        .t-cost { font-size: 0.8em; color: var(--talent-tree); font-weight: bold; }

        /* Licenses */
        .license-item {
            border: 1px dashed #666; padding: 10px; margin-bottom: 5px; border-radius: 5px;
            background: rgba(0,0,0,0.2);
        }
        .license-item.owned { border-style: solid; border-color: var(--gold); background: rgba(255, 215, 0, 0.1); }
        .req-tag { display: inline-block; background: #333; color: #aaa; font-size: 0.7em; padding: 2px 5px; border-radius: 3px; margin-right: 5px; }
        .req-tag.ok { color: #00ff00; }

        /* Manager & Storage */
        .manager-card {
            background: linear-gradient(135deg, rgba(40,40,40,0.9), rgba(20,20,20,0.95));
            border: 1px solid var(--secondary); padding: 20px; border-radius: 10px; text-align: center;
        }
        .toggle-btn {
            background: #444; color: #fff; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer;
        }
        .toggle-btn.on { background: var(--secondary); box-shadow: 0 0 10px var(--secondary); }

        /* --- ƒê·∫¶U T∆Ø M·∫†O HI·ªÇM (STYLE C≈®) --- */
        .invest-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #333;
            margin-top: 15px;
        }
        .chance-bar-bg {
            height: 10px; background: #222; border-radius: 5px;
            margin-bottom: 10px; position: relative; overflow: hidden; border: 1px solid #444;
        }
        .chance-fill {
            height: 100%; width: 50%;
            background: linear-gradient(90deg, #ff0055, #ffcc00, #00ff00);
            transition: width 0.05s linear;
        }
        #invest-btn {
            width: 100%; padding: 12px; background: linear-gradient(45deg, #800000, #ff0000);
            color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;
            font-family: 'Rajdhani', sans-serif; font-size: 1.1em;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3); transition: 0.2s;
        }
        #invest-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px red; }

        /* Map Selector */
        .map-selector {
            margin-top: auto; padding-top: 15px; border-top: 1px solid #333;
            display: flex; gap: 10px;
        }
        .map-btn { flex: 1; padding: 10px; border: 1px solid #444; background: #222; color: #555; cursor: not-allowed; border-radius: 5px; text-align: center; }
        .map-btn.active { border-color: var(--primary); background: rgba(0, 242, 255, 0.1); color: #fff; cursor: default; }
        
        /* Floating Gas Leak */
        .gas-leak {
            position: absolute; width: 60px; height: 60px;
            background: radial-gradient(circle, rgba(0,255,0,0.8), transparent 70%);
            border-radius: 50%; cursor: pointer; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: #fff;
            animation: floatGas 6s infinite ease-in-out;
            filter: blur(2px);
            transition: 0.2s;
        }
        .gas-leak:hover { filter: blur(0); transform: scale(1.2); }
        .gas-leak::after { content: '‚ö†Ô∏è'; font-size: 20px; }
        @keyframes floatGas { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(10deg); } }

        .float-txt {
            position: absolute; font-weight: bold; pointer-events: none; z-index: 999;
            animation: flyUp 1s forwards; font-size: 1.2em; text-shadow: 0 2px 2px #000;
        }
        @keyframes flyUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }

        /* Modal */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.95); z-index: 99999;
            display: flex; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); display: none;
        }
        .modal-content {
            background: #111; border: 2px solid var(--primary); padding: 40px; border-radius: 20px;
            text-align: center; max-width: 80%; box-shadow: 0 0 50px rgba(0, 242, 255, 0.2);
            animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-btn {
            background: var(--primary); color: #000; border: none; padding: 10px 30px;
            font-size: 1.2em; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 20px;
        }
        @keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #dev-cheat-btn {
            position: fixed; bottom: 5px; left: 5px; width: 15px; height: 15px;
            background-color: #ff0000; border-radius: 50%; cursor: pointer; z-index: 999999;
            opacity: 0.2; transition: all 0.3s;
        }
        /* H·ªá th·ªëng Popup ch√≠nh gi·ªØa m√†n h√¨nh */
.popup-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85); /* L√†m m·ªù n·ªÅn ph√≠a sau */
    display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
    justify-content: center;
    align-items: center;
    z-index: 999999; /* Lu√¥n n·∫±m tr√™n c√πng */
    backdrop-filter: blur(5px); /* L√†m nh√≤e n·ªÅn cho ƒë·∫πp */
}

.popup-box {
    background: #1a1b26;
    border: 3px solid #00f2ff;
    border-radius: 20px;
    padding: 40px;
    width: 400px;
    text-align: center;
    box-shadow: 0 0 50px rgba(0, 242, 255, 0.4);
    animation: popupShow 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}


@keyframes popupShow {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.popup-box h1 {
    font-family: 'Chakra Petch', sans-serif; /* ƒê·∫£m b·∫£o ti√™u ƒë·ªÅ popup kh√¥ng l·ªói */
    font-weight: 700;
}

.popup-box p {
    font-family: 'Chakra Petch', sans-serif;
    font-weight: 500;
}

.popup-close-btn {
    background: linear-gradient(45deg, #00f2ff, #7000ff);
    color: white;
    border: none;
    padding: 12px 40px;
    border-radius: 10px;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
    text-transform: uppercase;
}

.popup-close-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(0, 242, 255, 0.6);
}
    </style>
</head>
<body>

<div class="main-interface">
    <div class="panel">
        <h3><i class="fas fa-chart-line"></i> X∆Ø·ªûNG S·ªê 1</h3>
        
        <div class="stat-row">
            <span><i class="fas fa-wallet"></i> T√†i s·∫£n</span>
            <div class="stat-val currency">$<span id="money-display">0</span></div>
        </div>
        <div class="stat-row">
            <span><i class="fas fa-burn"></i> Kh√≠ Gas</span>
            <div class="stat-val" style="color: var(--primary);"><span id="gas-display">0</span> <small>L</small></div>
        </div>
        <div class="stat-row">
            <span><i class="fas fa-cubes"></i> Nh·ª±a HDPE</span>
            <div class="stat-val" style="color: var(--secondary);"><span id="hdpe-display">0</span> <small>kg</small></div>
        </div>
        <div class="stat-row" style="border-left-color: var(--talent-tree)">
            <span><i class="fas fa-brain"></i> ƒêi·ªÉm TP</span>
            <div class="stat-val" style="color: var(--talent-tree);"><span id="tp-display">0</span></div>
        </div>

        <div class="invest-section">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="font-size: 0.8em; color: #aaa;">T·ª∂ L·ªÜ TH·∫ÆNG:</span>
                <span id="win-chance-txt" style="font-weight: bold; color: var(--gold);">50%</span>
            </div>
            
            <div class="chance-bar-bg">
                <div id="chance-bar-fill" class="chance-fill"></div>
                <div style="position: absolute; left: 50%; top:0; height: 100%; width: 2px; background: rgba(255,255,255,0.3);"></div>
            </div>

            <button id="invest-btn" onclick="investRisky()">
                <i class="fas fa-dice"></i> ƒë·∫ßu t∆∞ m·∫°o hi·ªÉm
                <div style="font-size: 0.7em; font-weight: normal; opacity: 0.8;">C·∫ßn t·ªëi thi·ªÉu $5,000</div>
            </button>
        </div>

        <div style="margin-top: 20px; font-size: 0.9em; color: #888; text-align: center;">
            <p>S·∫£n l∆∞·ª£ng t·ª± ƒë·ªông: <span id="auto-rate-display">0</span> /s</p>
        </div>

        <div class="map-selector">
            <div class="map-btn active"><i class="fas fa-industry"></i> X∆∞·ªüng 1</div>
            <div class="map-btn" title="C·∫ßn ho√†n th√†nh X∆∞·ªüng 1"><i class="fas fa-lock"></i> X∆∞·ªüng 2</div>
        </div>
    </div>

    <div class="panel center-stage">
        <button id="main-btn" onclick="clickMine(event)">
           <i class="fas fa-compress-alt" style="font-size: 3.5em; color: var(--primary); filter: drop-shadow(0 0 10px var(--primary));"></i>
            <div>H√öT KH√ç</div>
        </button>

        <div class="temp-gauge">
            <div class="temp-fill" id="temp-bar"></div>
        </div>
        <div class="temp-text">NHI·ªÜT ƒê·ªò M√ÅY: <span id="temp-val">0</span>¬∞C</div>
        <div id="overheat-warning" style="color: var(--danger); font-weight: bold; display: none; margin-top: 10px; animation: blink 0.5s infinite;">‚ö†Ô∏è M√ÅY QU√Å NHI·ªÜT! ƒêANG L√ÄM M√ÅT...</div>

        <div style="margin-top: 30px; display: flex; gap: 10px;">
            <button onclick="convertResource()" style="padding: 10px 20px; background: rgba(0,0,0,0.5); border: 1px solid var(--primary); color: #fff; cursor: pointer; border-radius: 5px;">
                <i class="fas fa-compress-arrows-alt"></i> N√©n Kh√≠ (5L -> 1Kg HDPE)
            </button>
            <button onclick="sellAll()" style="padding: 10px 20px; background: rgba(0,0,0,0.5); border: 1px solid var(--gold); color: var(--gold); cursor: pointer; border-radius: 5px;">
                <i class="fas fa-dollar-sign"></i> B√°n H·∫øt Kho
            </button>
        </div>
    </div>

    <div class="panel">
        <div class="tab-header">
            <button class="tab-btn active" onclick="switchTab('upgrade')"><i class="fas fa-hammer"></i> N√¢ng C·∫•p</button>
            <button class="tab-btn" onclick="switchTab('talent')"><i class="fas fa-brain"></i> Thi√™n Ph√∫</button>
            <button class="tab-btn" onclick="switchTab('manager')"><i class="fas fa-user-tie"></i> Qu·∫£n L√Ω</button>
            <button class="tab-btn" onclick="switchTab('storage')"><i class="fas fa-warehouse"></i> Kho</button>
            <button class="tab-btn" onclick="switchTab('market')"><i class="fas fa-chart-bar"></i> Th·ªã Tr∆∞·ªùng</button>
        </div>

        <div id="tab-upgrade" class="tab-content active">
            <div class="upgrade-item" onclick="buyUpgrade('clicker')">
                <div class="u-info">
                    <h4><i class="fas fa-mouse-pointer"></i> Van √Åp Su·∫•t</h4>
                    <small>TƒÉng l∆∞·ª£ng kh√≠ m·ªói l·∫ßn b·∫•m</small>
                </div>
                <div class="u-btn">
                    <span class="cost">$<span id="cost-clicker">50</span></span>
                    <span class="lvl-badge">Lv.<span id="lvl-clicker">1</span></span>
                </div>
            </div>
            <div class="upgrade-item" onclick="buyUpgrade('miner')">
                <div class="u-info">
                    <h4><i class="fas fa-robot"></i> M√°y H√∫t T·ª± ƒê·ªông</h4>
                    <small>T·ª± ƒë·ªông h√∫t kh√≠ m·ªói gi√¢y</small>
                </div>
                <div class="u-btn">
                    <span class="cost">$<span id="cost-miner">200</span></span>
                    <span class="lvl-badge">Lv.<span id="lvl-miner">0</span></span>
                </div>
            </div>
            <div class="upgrade-item" onclick="buyUpgrade('coolant')">
                <div class="u-info">
                    <h4><i class="fas fa-snowflake"></i> H·ªá Th·ªëng T·∫£n Nhi·ªát</h4>
                    <small>Gi·∫£m nhi·ªát ƒë·ªô nhanh h∆°n</small>
                </div>
                <div class="u-btn">
                    <span class="cost">$<span id="cost-coolant">500</span></span>
                    <span class="lvl-badge">Lv.<span id="lvl-coolant">1</span></span>
                </div>
            </div>
             <div class="upgrade-item" onclick="buyUpgrade('compressor')">
                <div class="u-info">
                    <h4><i class="fas fa-compress"></i> M√°y N√©n Auto</h4>
                    <small>T·ª± ƒë·ªïi Kh√≠ sang Nh·ª±a</small>
                </div>
                <div class="u-btn">
                    <span class="cost">$<span id="cost-compressor">1000</span></span>
                    <span class="lvl-badge">Lv.<span id="lvl-compressor">0</span></span>
                </div>
            </div>
        </div>

        <div id="tab-talent" class="tab-content">
            <div class="tp-header">
                <div style="font-size:1.5em; font-weight:bold; color:#fff;">
                    <span id="tp-val-big">0</span> TP
                </div>
                <div style="display:flex; gap:5px; justify-content:center; margin-top:5px;">
                    <input type="number" id="tp-buy-input" value="1" style="width:50px; padding:5px; border-radius:5px; border:none; text-align:center;">
                    <button onclick="buyTP()" style="background:var(--talent-tree); color:#000; border:none; padding:5px 10px; cursor:pointer; border-radius:5px; font-weight:bold;">
                        MUA ($1k/ƒëi·ªÉm)
                    </button>
                </div>
            </div>

            <div class="talent-tree">
                <div class="talent-node" onclick="upgradeTalent('efficiency')">
                    <div class="t-icon"><i class="fas fa-hand-sparkles"></i></div>
                    <div class="t-data">
                        <div class="t-name">Hi·ªáu Su·∫•t Tay</div>
                        <span class="t-desc">TƒÉng l·ª±c h√∫t khi click (+10%/c·∫•p)</span>
                        <div class="t-cost">Chi ph√≠: <span id="cost-talent-efficiency">1</span> TP</div>
                    </div>
                    <div class="lvl-badge">Lv.<span id="lvl-talent-efficiency">0</span>/20</div>
                </div>

                <div class="talent-node locked" id="node-luck" onclick="upgradeTalent('luck')">
                    <div class="t-icon"><i class="fas fa-dice"></i></div>
                    <div class="t-data">
                        <div class="t-name">May M·∫Øn Khai Th√°c</div>
                        <span class="t-desc">T·ª∑ l·ªá 5% h√∫t x10 kh√≠ (TƒÉng theo c·∫•p)</span>
                        <div class="t-cost">Y√™u c·∫ßu: Hi·ªáu Su·∫•t Lv.5</div>
                    </div>
                    <div class="lvl-badge">Lv.<span id="lvl-talent-luck">0</span>/10</div>
                </div>

                <div class="talent-node" onclick="upgradeTalent('grease')">
                    <div class="t-icon"><i class="fas fa-oil-can"></i></div>
                    <div class="t-data">
                        <div class="t-name">B√¥i Tr∆°n M√°y</div>
                        <span class="t-desc">TƒÉng t·ªëc ƒë·ªô Auto Miner (+5%/c·∫•p)</span>
                        <div class="t-cost">Chi ph√≠: <span id="cost-talent-grease">1</span> TP</div>
                    </div>
                    <div class="lvl-badge">Lv.<span id="lvl-talent-grease">0</span>/50</div>
                </div>

                <div style="margin-top:20px; border-top:1px solid #444; padding-top:10px;">
                    <h4 style="color:var(--gold)">GI·∫§Y PH√âP</h4>
                    
                    <div class="license-item" id="lic-export" onclick="buyLicense('export')">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="font-weight:bold; color:#fff"><i class="fas fa-globe"></i> Gi·∫•y Ph√©p Xu·∫•t Kh·∫©u</span>
                            <span style="color:var(--gold)">$500,000</span>
                        </div>
                        <div style="font-size:0.8em; color:#aaa; margin-top:5px;">
                            T√°c d·ª•ng: Gi√° b√°n nh·ª±a lu√¥n tƒÉng 20%.
                        </div>
                        <div style="margin-top:5px;">
                            <span class="req-tag" id="req-export-lvl">C·∫ßn: Hi·ªáu Su·∫•t Lv.10</span>
                        </div>
                    </div>

                    <div class="license-item" id="lic-cooling" onclick="buyLicense('cooling')">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="font-weight:bold; color:#fff"><i class="fas fa-snowflake"></i> Ch·ª©ng Ch·ªâ ISO M√¥i Tr∆∞·ªùng</span>
                            <span style="color:var(--gold)">$1,000,000</span>
                        </div>
                        <div style="font-size:0.8em; color:#aaa; margin-top:5px;">
                            T√°c d·ª•ng: Gi·∫£m 50% nhi·ªát sinh ra.
                        </div>
                        <div style="margin-top:5px;">
                            <span class="req-tag" id="req-cooling-res">C·∫ßn: 50,000 Nh·ª±a trong kho</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-manager" class="tab-content">
            <div class="manager-card">
                <div class="manager-avatar"><i class="fas fa-user-astronaut"></i></div>
                <h3>Gi√°m ƒê·ªëc K·ªπ Thu·∫≠t</h3>
                <p style="font-size: 0.8em; color: #888; margin-bottom: 15px;">
                    "T√¥i s·∫Ω t·ª± ƒë·ªông d√πng ti·ªÅn ƒë·ªÉ n√¢ng c·∫•p c√°c m√°y m√≥c."
                </p>
                <div id="manager-locked">
                    <button class="upgrade-item" style="width: 100%; justify-content: center; background: #333;" onclick="hireManager()">
                        Thu√™: $1,000,000
                    </button>
                </div>
                <div id="manager-unlocked" style="display: none;">
                    <div class="manager-status">Tr·∫°ng th√°i: <span id="mgr-status-text" style="color: var(--secondary)">ƒêANG T·∫ÆT</span></div>
                    <button id="mgr-toggle" class="toggle-btn" onclick="toggleManager()">B·∫¨T QU·∫¢N L√ù</button>
                </div>
            </div>
        </div>

        <div id="tab-storage" class="tab-content">
            <div class="upgrade-item" style="cursor: default; flex-direction: column; align-items: flex-start;">
                <h4 style="color: var(--primary)">KHO TR·ªÆ NH·ª∞A</h4>
                <div style="font-size: 1.2em; margin: 10px 0;">
                    ƒêang ch·ª©a: <span id="storage-display" style="color: var(--secondary); font-weight: bold; font-size: 1.5em;">0</span> kg
                </div>
                <input type="number" id="storage-input" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng..." 
                       style="width: 90%; padding: 10px; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; margin-bottom: 10px; font-family: inherit;">
                <div style="display: flex; gap: 5px; width: 100%;">
                    <button onclick="depositAll()" class="upgrade-item" style="flex: 1; justify-content: center; background: #333; margin:0; border: 1px solid #555;">
                        <i class="fas fa-arrow-down"></i> G·ª≠i H·∫øt
                    </button>
                    <button onclick="withdrawX()" class="upgrade-item" style="flex: 1; justify-content: center; background: var(--secondary); margin:0; color: white;">
                        <i class="fas fa-arrow-up"></i> R√∫t Ra
                    </button>
                </div>
            </div>
        </div>

        <div id="tab-market" class="tab-content">
            <div style="display:flex; flex-direction:column; height:100%;">
                <div style="text-align:center; margin-bottom:10px;">
                    <h3>S√ÄN GIAO D·ªäCH HDPE</h3>
                    <h1 id="current-price-display" style="color:var(--gold); font-size: 2.5em;">$10.00</h1>
                </div>
                <div class="market-panel">
                    <div class="chart-container" id="chart-display">
                        </div>
                    <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:0.7em; color:#666;">
                        <span>-60s</span>
                        <span>Hi·ªán t·∫°i</span>
                    </div>
                </div>
                <div style="margin-top:15px; font-size:0.9em; color:#aaa; text-align:center;">
                    *Gi√° b√°n Nh·ª±a HDPE bi·∫øn ƒë·ªông m·ªói 2 gi√¢y. <br>H√£y canh gi√° cao ƒë·ªÉ b√°n!
                </div>
            </div>
        </div>

    </div>
</div>

<div id="big-modal" class="modal-overlay">
    <div class="modal-content">
        <h1 id="modal-title" style="font-size: 3em; margin: 0;">K·∫æT QU·∫¢</h1>
        <p id="modal-msg" style="font-size: 1.5em; margin: 20px 0;"></p>
        <button onclick="closeModal()" class="modal-btn">ƒê√É HI·ªÇU</button>
    </div>
</div>

<div id="dev-cheat-btn" onclick="runDevCheat()"></div>

<div id="toast-container" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 100000; display: flex; flex-direction: column; gap: 10px; align-items: center;"></div>

<script>
    // --- HELPER: TOAST (S·ª≠a l·ªói ch·ªìng ch·∫•t: Gi·ªõi h·∫°n 2 c√°i) ---
    function createToast(msg, type = 'normal') {
        let container = document.getElementById('toast-container');
        
        while (container.children.length >= 2) {
            container.removeChild(container.firstChild);
        }

        let toast = document.createElement('div');
        let color = '#fff';
        let bg = 'rgba(0,0,0,0.9)';
        let border = 'var(--primary)';
        
        if (type === 'error') { color = 'var(--danger)'; border = 'var(--danger)'; }
        if (type === 'money') { color = 'var(--gold)'; border = 'var(--gold)'; }
        if (type === 'success') { color = '#00ff00'; border = '#00ff00'; }

        toast.style.cssText = `
            padding: 15px 20px; background: ${bg}; border-left: 5px solid ${border};
            color: ${color}; border-radius: 5px; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: slideIn 0.3s ease-out; min-width: 250px; text-align: center;
        `;
        toast.innerHTML = msg;
        
        container.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => { if(toast.parentNode) toast.remove(); }, 500);
        }, 3000);
    }

    function createFloatText(x, y, text, color) {
        let el = document.createElement('div');
        el.className = 'float-txt';
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.color = color;
        el.innerText = text;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    // --- GAME DATA ---
    let game = {
        money: 0, gas: 0, hdpe: 0, temp: 0, storage: 0, isOverheat: false,
        manager: { owned: false, active: false, timer: 0 },
        items: {
            clicker: { lv: 1, cost: 50, name: "Van √Åp Su·∫•t" },
            miner:   { lv: 0, cost: 200, name: "M√°y H√∫t T·ª± ƒê·ªông" },
            coolant: { lv: 1, cost: 500, name: "T·∫£n Nhi·ªát" },
            compressor: { lv: 0, cost: 1000, name: "M√°y N√©n Auto" }
        },
        invest: { chance: 50, direction: 1, speed: 2 },
        // Thi√™n Ph√∫ M·ªõi
        talent: {
            tp: 0,
            levels: {
                efficiency: 0, // Click boost
                luck: 0,       // Crit chance
                grease: 0      // Auto speed
            }
        },
        licenses: {
            export: false,
            cooling: false
        },
        // Th·ªã tr∆∞·ªùng (Gi√° bi·∫øn ƒë·ªông)
        market: {
            currentPrice: 10,
            history: [] // L∆∞u l·ªãch s·ª≠ ƒë·ªÉ v·∫Ω n·∫øn
        }
    };

    // --- LOGIC GAME CH√çNH ---
    function clickMine(e) {
      // --- CODE TH√äM: HI·ªÜU ·ª®NG KH√ç (PARTICLES) ---
    for (let i = 0; i < 5; i++) {
        let puff = document.createElement('div');
        puff.className = 'gas-puff';
        // V·ªã tr√≠ xu·∫•t hi·ªán xung quanh n√∫t b·∫•m
        let rect = document.getElementById('main-btn').getBoundingClientRect();
        puff.style.left = (rect.left + rect.width / 2 + (Math.random() - 0.5) * 100) + 'px';
        puff.style.top = (rect.top + rect.height / 2) + 'px';
        document.body.appendChild(puff);
        setTimeout(() => puff.remove(), 800);
  
    // ------------------------------------------

    let baseAmount = 1 + (game.items.clicker.lv * 0.5);
    // ... (gi·ªØ nguy√™n ph·∫ßn logic game ph√≠a d∆∞·ªõi)
    let talentMult = 1 + (game.talent.levels.efficiency * 0.1);
    // ...
}
       // 1. Ki·ªÉm tra n·∫øu ƒëang qu√° nhi·ªát th√¨ kh√¥ng cho b·∫•m
    if (game.isOverheat) { 
        createToast("M√ÅY ƒêANG QU√Å T·∫¢I! H√£y ƒë·ª£i ngu·ªôi b·ªõt.", "error"); 
        return; 
    }
    // === HI·ªÜU ·ª®NG KH√ç N√ÇNG CAO ===
    let btn = document.getElementById('main-btn');
    let rect = btn.getBoundingClientRect();
    
    for (let i = 0; i < 8; i++) { // TƒÉng s·ªë l∆∞·ª£ng puff
        let puff = document.createElement('div');
        puff.className = 'gas-puff';
        
        // Random v·ªã tr√≠ xung quanh n√∫t
        let angle = (Math.PI * 2 * i) / 8;
        let distance = 50 + Math.random() * 50;
        let x = rect.left + rect.width / 2 + Math.cos(angle) * distance;
        let y = rect.top + rect.height / 2 + Math.sin(angle) * distance;
        
        puff.style.left = x + 'px';
        puff.style.top = y + 'px';
        puff.style.width = (30 + Math.random() * 30) + 'px';
        puff.style.height = puff.style.width;
        puff.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
        
        document.body.appendChild(puff);
        setTimeout(() => puff.remove(), 1200);
    }

    // Hi·ªáu ·ª©ng kh√≥i (gi·ªØ nguy√™n t·ª´ code tr∆∞·ªõc)
    for (let i = 0; i < 5; i++) {
        let puff = document.createElement('div');
        puff.className = 'gas-puff';
        let rect = document.getElementById('main-btn').getBoundingClientRect();
        puff.style.left = (rect.left + rect.width / 2 + (Math.random() - 0.5) * 100) + 'px';
        puff.style.top = (rect.top + rect.height / 2) + 'px';
        document.body.appendChild(puff);
        setTimeout(() => puff.remove(), 800);
    }

    let baseAmount = 1 + (game.items.clicker.lv * 0.5);
    let talentMult = 1 + (game.talent.levels.efficiency * 0.1);
    let finalAmount = baseAmount * talentMult;

    // T√≠nh to√°n ch√≠ m·∫°ng
    let critChance = game.talent.levels.luck * 0.05;
    if (Math.random() < critChance) {
        finalAmount *= 10;
        createFloatText(e.clientX, e.clientY, "CRIT X10!", "#ffcc00");
    }

    game.gas += finalAmount;
    
    // 2. TƒÉng nhi·ªát v√† ki·ªÉm tra qu√° nhi·ªát ngay l·∫≠p t·ª©c
    game.temp += 2; 
    if(game.temp >= 100) {
        game.temp = 100;
        game.isOverheat = true; // Kh√≥a m√°y ngay t·∫°i ƒë√¢y
        createToast("C·∫¢NH B√ÅO: H·ªÜ TH·ªêNG QU√Å NHI·ªÜT!", "error");
    }
    
    createFloatText(e.clientX, e.clientY, `+${finalAmount.toFixed(1)} Gas`, '#00f2ff');
    updateUI();

        game.gas += finalAmount;
        game.temp += 2;
        if(game.temp > 100) game.temp = 100;
        
        createFloatText(e.clientX, e.clientY, `+${finalAmount.toFixed(1)} Gas`, '#00f2ff');
        updateUI();
    }
    // C·∫≠p nh·∫≠t h√†m convertResource() - Th√™m hi·ªáu ·ª©ng n√©n
function convertResource() {
    if (game.gas >= 5) {
        let btn = event.target.closest('button');
        let rect = btn.getBoundingClientRect();
        
       // T·∫°o 8 puff kh√≠ xung quanh
        for (let i = 0; i < 8; i++) {
            let puff = document.createElement('div');
            puff.className = 'gas-puff';
            
            let angle = (Math.PI * 2 * i) / 8;
            let distance = 50 + Math.random() * 50;
            let x = rect.left + rect.width / 2 + Math.cos(angle) * distance;
            let y = rect.top + rect.height / 2 + Math.sin(angle) * distance;
            
            puff.style.left = x + 'px';
            puff.style.top = y + 'px';
            puff.style.width = (30 + Math.random() * 30) + 'px';
            puff.style.height = puff.style.width;
            puff.style.setProperty('--drift', (Math.random() - 0.5) * 100 + 'px');
            
            document.body.appendChild(puff);
            setTimeout(() => puff.remove(), 1200);
        }
        
        let packs = Math.floor(game.gas / 5);
        game.gas -= packs * 5;
        game.hdpe += packs;
        createToast(`N√©n ƒë∆∞·ª£c ${packs}kg Nh·ª±a`, 'success');
        updateUI();
    } else {
        createToast('C·∫ßn 5L kh√≠!', 'error');
    }
}

// C·∫≠p nh·∫≠t h√†m sellAll() - Th√™m hi·ªáu ·ª©ng ti·ªÅn
function sellAll() {
    if (game.hdpe <= 0) { createToast('H·∫øt h√†ng!', 'error'); return; }
    
    let btn = event.target.closest('button');
    let rect = btn.getBoundingClientRect();
    
    // T·∫°o ƒë·ªìng xu bay l√™n
    for (let i = 0; i < 15; i++) {
        setTimeout(() => {
            let coin = document.createElement('div');
            coin.className = 'coin-particle';
            coin.innerText = 'üí∞';
            
            let x = rect.left + rect.width / 2 + (Math.random() - 0.5) * 100;
            let y = rect.top + rect.height / 2;
            
            coin.style.left = x + 'px';
            coin.style.top = y + 'px';
            
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 1000);
        }, i * 50); // Delay gi·ªØa c√°c ƒë·ªìng xu
    }
    
    let price = game.market.currentPrice;
    if (game.licenses.export) price *= 1.2;

    let earned = Math.floor(game.hdpe * price);
    game.money += earned;
    game.hdpe = 0;
    createToast(`B√°n h·∫øt v·ªõi gi√° $${price.toFixed(2)}/kg. Thu v·ªÅ $${earned.toLocaleString()}`, 'money');
    updateUI();
}

    // --- UPGRADE SYSTEM ---
    function buyUpgrade(type) {
        let item = game.items[type];
        if (game.money >= item.cost) {
            game.money -= item.cost;
            item.lv++;
            item.cost = Math.floor(item.cost * 1.5);
            createToast(`N√¢ng c·∫•p ${item.name} l√™n Lv.${item.lv}`, 'success');
            updateUI();
        } else { createToast('Kh√¥ng ƒë·ªß ti·ªÅn!', 'error'); }
    }

    // --- TALENT SYSTEM ---
    function buyTP() {
        let input = document.getElementById('tp-buy-input');
        let amount = parseInt(input.value);
        if(!amount || amount < 1) amount = 1;

        let costPerTP = 1000; // Gi√° r·∫ª 1k
        let totalCost = amount * costPerTP;

        if (game.money >= totalCost) {
            game.money -= totalCost;
            game.talent.tp += amount;
            createToast(`ƒê√£ mua ${amount} TP`, 'success');
            updateUI();
        } else {
            createToast(`C·∫ßn $${totalCost.toLocaleString()} ƒë·ªÉ mua!`, 'error');
        }
    }

    function upgradeTalent(type) {
        let currentLv = game.talent.levels[type];
        let maxLv = (type === 'grease') ? 50 : (type === 'efficiency' ? 20 : 10);
        
        if (currentLv >= maxLv) {
            createToast("ƒê√£ ƒë·∫°t c·∫•p t·ªëi ƒëa!", "error");
            return;
        }

        if (type === 'luck' && game.talent.levels.efficiency < 5) {
            createToast("C·∫ßn m·ªü kh√≥a Hi·ªáu Su·∫•t Lv.5 tr∆∞·ªõc!", "error");
            return;
        }

        let cost = Math.floor(1 + (currentLv * 0.5)); 

        if (game.talent.tp >= cost) {
            game.talent.tp -= cost;
            game.talent.levels[type]++;
            updateUI();
        } else {
            createToast(`C·∫ßn ${cost} TP!`, 'error');
        }
    }

    function buyLicense(type) {
        if(game.licenses[type]) return; 

        let cost = 0;
        let canBuy = false;

        if(type === 'export') {
            cost = 500000;
            if(game.talent.levels.efficiency >= 10) canBuy = true;
            else createToast("Y√™u c·∫ßu: Hi·ªáu Su·∫•t Lv.10", "error");
        }
        else if(type === 'cooling') {
            cost = 1000000;
            if(game.storage >= 50000) canBuy = true; 
            else createToast("Y√™u c·∫ßu: Kho ph·∫£i ch·ª©a 50,000kg nh·ª±a", "error");
        }

        if(canBuy) {
            if(game.money >= cost) {
                game.money -= cost;
                game.licenses[type] = true;
                createToast("Mua gi·∫•y ph√©p th√†nh c√¥ng!", "success");
                updateUI();
            } else {
                createToast("Kh√¥ng ƒë·ªß ti·ªÅn!", "error");
            }
        }
    }

    // --- MARKET SYSTEM (CANDLESTICK CHART) ---
    function updateMarket() {
        let volatility = 2.0; 
        let change = (Math.random() - 0.5) * volatility;
        let open = game.market.currentPrice;
        let close = open + change;
        
        if(close < 5) close = 5;
        if(close > 100) close = 100;

        game.market.currentPrice = close;

        // L∆∞u n·∫øn
        let high = Math.max(open, close) + Math.random();
        let low = Math.min(open, close) - Math.random();
        
        game.market.history.push({ open, close, high, low });
        if(game.market.history.length > 30) game.market.history.shift(); // Hi·ªán 30 n·∫øn

        drawChart();
    }

    function drawChart() {
        let container = document.getElementById('chart-display');
        container.innerHTML = ''; 

        let minP = 1000, maxP = 0;
        game.market.history.forEach(c => {
            if(c.high > maxP) maxP = c.high;
            if(c.low < minP) minP = c.low;
        });
        let range = maxP - minP || 1;

        game.market.history.forEach(c => {
            let isUp = c.close >= c.open;
            let color = isUp ? '#00ff00' : '#ff3333';
            
            let hPercent = ((c.high - minP) / range) * 80;
            let lPercent = ((c.low - minP) / range) * 80;
            let oPercent = ((c.open - minP) / range) * 80;
            let cPercent = ((c.close - minP) / range) * 80;

            let candle = document.createElement('div');
            candle.className = 'candle';
            candle.style.height = '100%';
            
            let wick = document.createElement('div');
            wick.className = 'candle-wick';
            wick.style.bottom = lPercent + '%';
            wick.style.height = (hPercent - lPercent) + '%';
            wick.style.backgroundColor = color;

            let body = document.createElement('div');
            body.className = 'candle-body';
            body.style.bottom = Math.min(oPercent, cPercent) + '%';
            body.style.height = Math.max(0.5, Math.abs(cPercent - oPercent)) + '%';
            body.style.backgroundColor = color;

            candle.appendChild(wick);
            candle.appendChild(body);
            container.appendChild(candle);
        });

        document.getElementById('current-price-display').innerText = `$${game.market.currentPrice.toFixed(2)}`;
    }

    // --- OTHER SYSTEMS ---
    function depositAll() {
        if(game.hdpe > 0) { game.storage += game.hdpe; game.hdpe = 0; updateUI(); }
        else createToast("Kh√¥ng c√≥ nh·ª±a!", "error");
    }
    function withdrawX() {
        let v = parseInt(document.getElementById('storage-input').value);
        if(!v) return;
        if(game.storage >= v) { game.storage -= v; game.hdpe += v; updateUI(); createToast(`R√∫t ${v}kg`, 'success'); }
        else createToast("Kho thi·∫øu h√†ng!", "error");
    }
    function hireManager() {
        if(game.money >= 1000000) {
            game.money -= 1000000; game.manager.owned = true;
            document.getElementById('manager-locked').style.display='none';
            document.getElementById('manager-unlocked').style.display='block';
            updateUI();
        } else createToast("Thi·∫øu ti·ªÅn!", "error");
    }
    function toggleManager() { game.manager.active = !game.manager.active; updateUI(); }
    
    function switchTab(t) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
        document.getElementById('tab-'+t).classList.add('active');
        
        // Highlight logic
        let btns = document.querySelectorAll('.tab-btn');
        if(t==='upgrade') btns[0].classList.add('active');
        if(t==='talent') btns[1].classList.add('active');
        if(t==='manager') btns[2].classList.add('active');
        if(t==='storage') btns[3].classList.add('active');
        if(t==='market') btns[4].classList.add('active');
    }

    // --- ƒê·∫¶U T∆Ø M·∫†O HI·ªÇM (STYLE C≈® + MODAL TO) ---
    function updateInvestBar() {
        game.invest.chance += (game.invest.direction * game.invest.speed);
        if (game.invest.chance >= 60) {
            game.invest.chance = 60; game.invest.direction = -1;
        } else if (game.invest.chance <= 0) {
            game.invest.chance = 0; game.invest.direction = 1;
        }

        let barFill = document.getElementById('chance-bar-fill');
        let txtWin = document.getElementById('win-chance-txt');
        
        if(barFill && txtWin) {
            barFill.style.width = game.invest.chance + "%";
            txtWin.innerText = Math.floor(game.invest.chance) + "%";
            if(game.invest.chance < 20) txtWin.style.color = 'var(--danger)';
            else if(game.invest.chance > 50) txtWin.style.color = '#00ff00';
            else txtWin.style.color = 'var(--gold)';
        }
    }

    // --- ƒêO·∫†N CODE ƒê·∫¶U T∆Ø T·∫§T TAY M·ªöI ---
// 1. H√†m d√πng chung ƒë·ªÉ hi·ªán th√¥ng b√°o b·∫•t c·ª© l√∫c n√†o
function showMyPopup(title, message, titleColor) {
    document.getElementById('p-title').innerText = title;
    document.getElementById('p-title').style.color = titleColor;
    document.getElementById('p-message').innerHTML = message;
    document.getElementById('custom-popup').style.display = 'flex';
}

// 2. H√†m ƒë·ªÉ ƒë√≥ng th√¥ng b√°o
function closeMyPopup() {
    document.getElementById('custom-popup').style.display = 'none';
}

// 3. Logic ƒê·∫¶U T∆Ø T·∫§T TAY (ƒê√£ t√≠ch h·ª£p b·∫£ng th√¥ng b√°o m·ªõi)
function investRisky() {
    // Ki·ªÉm tra v·ªën t·ªëi thi·ªÉu 5000
    if (game.money < 5000) {
        showMyPopup("C·∫¢NH B√ÅO", "D∆∞·ªõi $5,000 m√† ƒë·∫ßu t∆∞ v√†o HDPE th√¨ kh√°c g√¨ mu·ªëi b·ªè bi·ªÉn!", "#ff0055");
        return;
    }

    let allInAmount = game.money; // L·∫•y to√†n b·ªô ti·ªÅn
    let winChance = game.invest.chance; // L·∫•y t·ª∑ l·ªá th·∫Øng hi·ªán t·∫°i tr√™n thanh bar
    let isWin = (Math.random() * 100) <= winChance;

    if (isWin) {
        // TH·∫ÆNG: Nh√¢n ƒë√¥i t√†i s·∫£n
        game.money += allInAmount;
        showMyPopup(
            "TH·∫ÆNG L·ªöN!", 
            `HDPE th√¨ ngon nu√¥n , <br>T√†i s·∫£n nh√¢n ƒë√¥i!`, 
            "#00ff9d"
        );
    } else {
        // THUA: M·∫•t tr·∫Øng
        game.money = 0;
        showMyPopup(
            "M·∫§T TR·∫ÆNG!", 
            `ch·ªõp m·∫Øt m·ªôt c√°i l√† c√≤n c√°i l·ªãt nu√¥n`, 
            "#ff0055"
        );
    }

    updateUI(); // C·∫≠p nh·∫≠t l·∫°i s·ªë ti·ªÅn tr√™n m√†n h√¨nh ch√≠nh
}


    // --- MAIN LOOP (100ms) ---
    setInterval(() => {
        updateInvestBar();

        if (game.items.miner.lv > 0 && !game.isOverheat) {
            let speedMult = 1 + (game.talent.levels.grease * 0.05);
            game.gas += (game.items.miner.lv * 0.2 * speedMult) / 10;
            game.temp += 0.05;
        }
        
        let cool = 0.1 + (game.items.coolant.lv * 0.05);
        if(game.temp > 0) game.temp -= cool;
        if(game.temp < 0) game.temp = 0;
        
        if(game.temp >= 100) game.isOverheat = true;
        if(game.isOverheat && game.temp <= (game.licenses.cooling ? 80 : 50)) game.isOverheat = false;

        game.manager.timer++;
        if(game.manager.timer > 10 && game.manager.active) {
            game.manager.timer = 0;
            let list = Object.keys(game.items).map(k=>({k, ...game.items[k]})).sort((a,b)=>a.cost-b.cost);
            if(game.money >= list[0].cost) buyUpgrade(list[0].k);
        }

        updateUI();
    }, 100);

    // Market Loop (2s)
    setInterval(updateMarket, 2000);

    function updateUI() {
        document.getElementById('money-display').innerText = Math.floor(game.money).toLocaleString();
        document.getElementById('gas-display').innerText = Math.floor(game.gas).toLocaleString();
        document.getElementById('hdpe-display').innerText = Math.floor(game.hdpe).toLocaleString();
        document.getElementById('tp-display').innerText = game.talent.tp.toLocaleString();
        document.getElementById('storage-display').innerText = game.storage.toLocaleString();
        
        document.getElementById('temp-val').innerText = Math.floor(game.temp);
        document.getElementById('temp-bar').style.width = game.temp + "%";
        document.getElementById('overheat-warning').style.display = game.isOverheat ? 'block' : 'none';

        for(let k in game.items) {
            document.getElementById(`cost-${k}`).innerText = game.items[k].cost.toLocaleString();
            document.getElementById(`lvl-${k}`).innerText = game.items[k].lv;
        }

        document.getElementById('tp-val-big').innerText = game.talent.tp;
        
        let c1 = Math.floor(1 + game.talent.levels.efficiency * 0.5);
        document.getElementById('cost-talent-efficiency').innerText = c1;
        document.getElementById('lvl-talent-efficiency').innerText = game.talent.levels.efficiency;

        if(game.talent.levels.efficiency >= 5) {
            document.getElementById('node-luck').classList.remove('locked');
            document.getElementById('node-luck').querySelector('.t-cost').innerText = "Chi ph√≠: 1 TP";
        }
        document.getElementById('lvl-talent-luck').innerText = game.talent.levels.luck;

        let c3 = Math.floor(1 + game.talent.levels.grease * 0.5);
        document.getElementById('cost-talent-grease').innerText = c3;
        document.getElementById('lvl-talent-grease').innerText = game.talent.levels.grease;

        if(game.licenses.export) document.getElementById('lic-export').classList.add('owned');
        if(game.licenses.cooling) document.getElementById('lic-cooling').classList.add('owned');
        
        let reqExp = document.getElementById('req-export-lvl');
        if(game.talent.levels.efficiency >= 10) { reqExp.classList.add('ok'); reqExp.innerText = "ƒê·ªß ƒëi·ªÅu ki·ªán"; }
        
        let reqCool = document.getElementById('req-cooling-res');
        if(game.storage >= 50000) { reqCool.classList.add('ok'); reqCool.innerText = "ƒê·ªß ƒëi·ªÅu ki·ªán"; }
    }
  // H·ªÜ TH·ªêNG CHEAT B·∫∞NG PH√çM T·∫ÆT M·ªöI (CTRL + Q)
window.addEventListener('keydown', function(e) {
    // Ki·ªÉm tra n·∫øu nh·∫•n ph√≠m Ctrl v√† ph√≠m Q (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)
    if (e.ctrlKey && (e.key === 'q' || e.key === 'Q')) {
        e.preventDefault(); // NgƒÉn tr√¨nh duy·ªát ƒë√≥ng tab ho·∫∑c c√°c t√≠nh nƒÉng kh√°c

        // 1. Hi·ªán b·∫£ng nh·∫≠p s·ªë ti·ªÅn
        let input = prompt("H·ªÜ TH·ªêNG HACK: NH·∫¨P S·ªê TI·ªÄN B·∫†N MU·ªêN:");

        // 2. Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng nh·∫•n OK v√† c√≥ nh·∫≠p n·ªôi dung
        if (input !== null && input !== "") {
            let moneyAmount = parseInt(input);

            // 3. Ki·ªÉm tra xem c√≥ ph·∫£i l√† s·ªë h·ª£p l·ªá kh√¥ng
            if (!isNaN(moneyAmount)) {
                game.money += moneyAmount; // C·ªông s·ªë ti·ªÅn v·ª´a nh·∫≠p v√†o game
                updateUI(); // C·∫≠p nh·∫≠t l·∫°i m√†n h√¨nh hi·ªÉn th·ªã

                // S·ª≠ d·ª•ng h√†m Popup x·ªãn ƒë·ªÉ th√¥ng b√°o (n·∫øu c√≥)
                if (typeof showMyPopup === "function") {
                    showMyPopup(
                        "HACK TH√ÄNH C√îNG", 
                        `ƒê√£ b∆°m th√™m <b style='color:gold'>$${moneyAmount.toLocaleString()}</b> v√†o t√†i kho·∫£n!`, 
                        "#00ff9d"
                    );
                } else {
                    alert("ƒê√£ th√™m: $" + moneyAmount.toLocaleString());
                }
            } else {
                alert("Vui l√≤ng ch·ªâ nh·∫≠p s·ªë, kh√¥ng nh·∫≠p ch·ªØ!");
            }
        }
    }
});
</script>
<div class="modal-overlay" id="invest-modal" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 10000; display: none; justify-content: center; align-items: center; font-family: 'Rajdhani', sans-serif;">
    <div style="background: #151520; border: 2px solid #00f2ff; padding: 30px; border-radius: 20px; text-align: center; max-width: 400px; width: 90%; box-shadow: 0 0 30px rgba(0,242,255,0.3);">
        <h1 id="inv-res-title" style="font-size: 2.5em; margin: 0; text-transform: uppercase;">TH·∫ÆNG!</h1>
        <p id="inv-res-msg" style="font-size: 1.2em; margin: 20px 0; color: #e0e6ed;"></p>
        <button onclick="document.getElementById('invest-modal').style.display='none'" style="width: 100%; padding: 15px; background: #00f2ff; color: #000; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-family: inherit; font-size: 1.1em;">ƒê√É HI·ªÇU</button>
    </div>
</div>
<div id="custom-popup" class="popup-overlay">
    <div class="popup-box">
        <h1 id="p-title">TH√îNG B√ÅO</h1>
        <p id="p-message">N·ªôi dung th√¥ng b√°o ·ªü ƒë√¢y...</p>
        <button class="popup-close-btn" onclick="closeMyPopup()">X√ÅC NH·∫¨N</button>
    </div>
   
</div>
</body>
</html>

